---
title: "Projekt_3"
author: "Kamil Sarzyniak, Piotr Stawarski"
date: '2024-11-06'
output: pdf
---

```{r}
library(forecast)
library(tseries)
library(MASS)
library(ggplot2)
library(tidyr)
```

```{r}
n_values <- c(50, 100, 1000)
ar_values <- c(.1, .5, .9)
n_reps <- 1000
results <- vector("list", n_reps)
```



```{r}
n_values <- c(50, 100, 1000)
ar_values <- c(.1, .5, .9)

for (rep in 1:n_reps) {
  rep_results <- list()
  
  for (N in n_values) {
      estimates <- matrix(NA, nrow = N, ncol = 3)
      stderrs <- matrix(NA, nrow = N, ncol = 3)
      residual_acf <- matrix(NA, nrow = N, ncol = 20)
      i <- 1
    
      for (AR in ar_values) {
        xt1 = arima.sim(list(order=c(1,0,0), ar=AR), n=N)
        
        xt3 = Arima(xt1, order = c(3,1,0))
        
        estimates[i, ] <- xt3$coef[1:3]
        stderrs[i, ] <- sqrt(diag(xt3$var.coef))[1:3]
        residual_acf[i, ] <- acf(residuals(xt3), plot = FALSE)$acf[2:21]
        i <- i + 1
      }
      rep_results[[paste0("N_", N)]] <- list(
      estimates = estimates,
      stderrs = stderrs,
      residual_acf = residual_acf
    )
  }
  results[[rep]] <- rep_results
}
```

```{r}
combine_estimates <- function(results, N) {
  do.call(rbind, lapply(results, function(rep) rep[[N]]$estimates))
}
```

```{r}
summarize_estimates <- function(estimates_all, true_params) {
  mean_estimates <- colMeans(estimates_all, na.rm = TRUE)
  bias <- mean_estimates - true_params
  sd_estimates <- apply(estimates_all, 2, sd, na.rm = TRUE)
  
  data.frame(
    Parameter = paste0("AR", 1:3),
    Mean = mean_estimates,
    Bias = bias,
    SD = sd_estimates
  )
}
```

```{r}
analyze_all <- function(results, true_params) {
  summary_list <- list()
  
  for (N in names(results[[1]])) {
    estimates_all <- combine_estimates(results, N)
    summary_list[[N]] <- summarize_estimates(estimates_all, true_params)
  }
  
  return(summary_list)
}
```

```{r}
# Analiza wyników
true_params <- c(.1, .5, .9)  # Prawdziwe parametry AR(1)
summary_results <- analyze_all(results, true_params)

# Wyświetlenie wyników dla różnych długości N
for (N in names(summary_results)) {
  cat(paste0("Długość danych: ", N, "\n"))
  print(summary_results[[N]])
  cat("\n")
}

# Wizualizacja rozkładów estymatorów dla N=1000
N_focus <- "N_1000"
estimates_all <- do.call(rbind, lapply(results, function(rep) rep[[N_focus]]$estimates))
colnames(estimates_all) <- paste0("AR", 1:3)

# Histogramy oszacowań parametrów
estimates_df <- data.frame(estimates_all)
estimates_df_long <- estimates_df %>%
  pivot_longer(cols = everything(), names_to = "variable", values_to = "value")

ggplot(estimates_df_long, aes(x = value)) +
  geom_histogram(bins = 30, color = "black", fill = "skyblue", alpha = 0.7) +
  facet_wrap(~variable, scales = "free", ncol = 1) +
  theme_minimal() +
  labs(
    title = "Rozkład estymatorów parametrów AR(3) przy danych z AR(1)",
    x = "Wartość estymatora",
    y = "Częstość"
  )
```
```{r}
# Generacja danych z AR(3) i dopasowanie modelu AR(1)
results_ar3_to_ar1 <- vector("list", n_reps)

for (rep in 1:n_reps) {
  rep_results <- list()
  
  for (N in n_values) {
    estimates <- matrix(NA, nrow = N, ncol = 1)
    stderrs <- matrix(NA, nrow = N, ncol = 1)
    residual_acf <- matrix(NA, nrow = N, ncol = 20)
    
    xt_ar3 <- arima.sim(list(order = c(3, 0, 0), ar = c(.1, .5, .3)), n = N)
    xt_ar1 <- Arima(xt_ar3, order = c(1, 0, 0))
    
    estimates[1, ] <- xt_ar1$coef[1]
    stderrs[1, ] <- sqrt(diag(xt_ar1$var.coef))[1]
    residual_acf[1, ] <- acf(residuals(xt_ar1), plot = FALSE)$acf[2:21]
    
    rep_results[[paste0("N_", N)]] <- list(
      estimates = estimates,
      stderrs = stderrs,
      residual_acf = residual_acf
    )
  }
  results_ar3_to_ar1[[rep]] <- rep_results
}
```


```{r}
# Analiza wyników dla AR(3) -> AR(1)
true_param_ar1 <- 0.1  # Oczekiwany parametr w przypadku dopasowania AR(1)

analyze_ar3_to_ar1 <- function(results, true_param) {
  summary_list <- list()
  
  for (N in names(results[[1]])) {
    estimates_all <- do.call(rbind, lapply(results, function(rep) rep[[N]]$estimates))
    
    mean_estimates <- colMeans(estimates_all, na.rm = TRUE)
    bias <- mean_estimates - true_param
    sd_estimates <- apply(estimates_all, 2, sd, na.rm = TRUE)
    
    summary_list[[N]] <- data.frame(
      Parameter = "AR1",
      Mean = mean_estimates,
      Bias = bias,
      SD = sd_estimates
    )
  }
  
  return(summary_list)
}

# Analiza wyników
summary_results_ar3_to_ar1 <- analyze_ar3_to_ar1(results_ar3_to_ar1, true_param_ar1)

for (N in names(summary_results_ar3_to_ar1)) {
  cat(paste0("Długość danych: ", N, "\n"))
  print(summary_results_ar3_to_ar1[[N]])
  cat("\n")
}
```